# Nudge API Documentation

## Overview

The Nudge API provides endpoints for managing "Nudges" - notifications or reminders associated with events. A Nudge is used to prompt users about upcoming events, special announcements, or time-sensitive information related to an event.

---

## Object Data Model

### Nudge Schema

| Field | Type | Description |
|-------|------|-------------|
| `_id` | ObjectId | Unique identifier for the nudge (auto-generated by MongoDB) |
| `event_tag` | ObjectId | ID reference to the associated Event |
| `title` | String | Title of the nudge (max 100 characters) |
| `cover_image` | String | URL or path to the cover image |
| `scheduled_time` | Date | Timestamp when the nudge should be sent/displayed |
| `description` | String | Detailed description of the nudge |
| `icon` | String | URL or path to the nudge icon |
| `invitation` | String | One-line invitation text (max 150 characters) |
| `created_at` | Date | Timestamp when the nudge was created |
| `updated_at` | Date | Timestamp when the nudge was last updated |

### Example Nudge Object

```json
{
    "_id": "64f5a7b2e123456789abcdef",
    "event_tag": "64f5a6c1e987654321fedcba",
    "title": "Don't Miss Our Tech Conference!",
    "cover_image": "https://example.com/images/tech-conf-cover.jpg",
    "scheduled_time": "2024-03-15T09:00:00.000Z",
    "description": "Join us for an exciting day of tech talks, networking, and hands-on workshops. Early bird registration ends soon!",
    "icon": "https://example.com/icons/bell.png",
    "invitation": "Register now and get 20% off on early bird tickets!",
    "created_at": "2024-02-01T10:30:00.000Z",
    "updated_at": "2024-02-01T10:30:00.000Z"
}
```

---

## API Endpoints

**Base URL:** `/api/v3/app`

---

### 1. Create a Nudge

| Property | Value |
|----------|-------|
| **Request Type** | `POST` |
| **Endpoint** | `/nudges` |
| **Full URL** | `/api/v3/app/nudges` |
| **Description** | Creates a new nudge associated with an event |

#### Request Payload

```json
{
    "event_tag": "64f5a6c1e987654321fedcba",
    "title": "Don't Miss Our Tech Conference!",
    "cover_image": "https://example.com/images/tech-conf-cover.jpg",
    "scheduled_time": "2024-03-15T09:00:00.000Z",
    "description": "Join us for an exciting day of tech talks...",
    "icon": "https://example.com/icons/bell.png",
    "invitation": "Register now and get 20% off!"
}
```

#### Success Response (201 Created)

```json
{
    "success": true,
    "message": "Nudge created successfully",
    "data": {
        "_id": "64f5a7b2e123456789abcdef"
    }
}
```

---

### 2. Get Nudge by ID

| Property | Value |
|----------|-------|
| **Request Type** | `GET` |
| **Endpoint** | `/nudges?id=:nudge_id` |
| **Full URL** | `/api/v3/app/nudges?id=64f5a7b2e123456789abcdef` |
| **Description** | Fetches a single nudge by its MongoDB `_id` |

#### Query Parameters

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `id` | String | Yes | The MongoDB ObjectId of the nudge |

#### Success Response (200 OK)

```json
{
    "success": true,
    "data": {
        "_id": "64f5a7b2e123456789abcdef",
        "event_tag": "64f5a6c1e987654321fedcba",
        "title": "Don't Miss Our Tech Conference!",
        "cover_image": "https://example.com/images/tech-conf-cover.jpg",
        "scheduled_time": "2024-03-15T09:00:00.000Z",
        "description": "Join us for an exciting day of tech talks...",
        "icon": "https://example.com/icons/bell.png",
        "invitation": "Register now and get 20% off!",
        "created_at": "2024-02-01T10:30:00.000Z",
        "updated_at": "2024-02-01T10:30:00.000Z"
    }
}
```

---

### 3. Get Nudges by Event

| Property | Value |
|----------|-------|
| **Request Type** | `GET` |
| **Endpoint** | `/nudges?event_id=:event_id` |
| **Full URL** | `/api/v3/app/nudges?event_id=64f5a6c1e987654321fedcba` |
| **Description** | Fetches all nudges associated with a specific event |

#### Query Parameters

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `event_id` | String | Yes | The MongoDB ObjectId of the associated event |

#### Success Response (200 OK)

```json
{
    "success": true,
    "data": [
        {
            "_id": "64f5a7b2e123456789abcdef",
            "event_tag": "64f5a6c1e987654321fedcba",
            "title": "Don't Miss Our Tech Conference!",
            ...
        },
        {
            "_id": "64f5a7b2e123456789abcdeg",
            "event_tag": "64f5a6c1e987654321fedcba",
            "title": "Last Chance to Register!",
            ...
        }
    ],
    "count": 2
}
```

---

### 4. Get Latest Nudges (Paginated)

| Property | Value |
|----------|-------|
| **Request Type** | `GET` |
| **Endpoint** | `/nudges?type=latest&limit=:limit&page=:page` |
| **Full URL** | `/api/v3/app/nudges?type=latest&limit=10&page=1` |
| **Description** | Fetches nudges sorted by scheduled time (descending) with pagination |

#### Query Parameters

| Parameter | Type | Required | Default | Description |
|-----------|------|----------|---------|-------------|
| `type` | String | Yes | - | Must be `latest` |
| `limit` | Integer | No | 10 | Number of nudges per page |
| `page` | Integer | No | 1 | Page number |

#### Success Response (200 OK)

```json
{
    "success": true,
    "data": [...],
    "pagination": {
        "currentPage": 1,
        "limit": 10,
        "totalNudges": 50,
        "totalPages": 5
    }
}
```

---

### 5. Update a Nudge

| Property | Value |
|----------|-------|
| **Request Type** | `PUT` |
| **Endpoint** | `/nudges/:id` |
| **Full URL** | `/api/v3/app/nudges/64f5a7b2e123456789abcdef` |
| **Description** | Updates an existing nudge by its ID |

#### URL Parameters

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `id` | String | Yes | The MongoDB ObjectId of the nudge |

#### Request Payload

Send only the fields you want to update:

```json
{
    "title": "Updated: Tech Conference Reminder",
    "invitation": "Only 2 days left to register!"
}
```

#### Success Response (200 OK)

```json
{
    "success": true,
    "message": "Nudge updated successfully",
    "data": {
        "modifiedCount": 1
    }
}
```

---

### 6. Delete a Nudge

| Property | Value |
|----------|-------|
| **Request Type** | `DELETE` |
| **Endpoint** | `/nudges/:id` |
| **Full URL** | `/api/v3/app/nudges/64f5a7b2e123456789abcdef` |
| **Description** | Deletes a nudge by its ID |

#### URL Parameters

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `id` | String | Yes | The MongoDB ObjectId of the nudge |

#### Success Response (200 OK)

```json
{
    "success": true,
    "message": "Nudge deleted successfully"
}
```

---

## Error Responses

All endpoints return consistent error responses:

### 400 Bad Request

```json
{
    "success": false,
    "message": "Invalid Nudge ID format"
}
```

### 404 Not Found

```json
{
    "success": false,
    "message": "Nudge not found"
}
```

### 500 Internal Server Error

```json
{
    "success": false,
    "message": "Internal server error",
    "error": "Error details (development mode only)"
}
```

---

## Notes

1. All dates should be provided in ISO 8601 format (e.g., `2024-03-15T09:00:00.000Z`).
2. The `event_tag` field must reference a valid Event ID from the Events collection.
3. Image and icon fields should contain valid URLs or file paths.
4. The `invitation` field is intended for short, compelling call-to-action text.
